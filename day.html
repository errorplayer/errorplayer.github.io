<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Stranger Social Daily Board</title>
    <!-- 引入刚刚下载的 ECharts 文件 -->
    <script src="echarts.js"></script>
    <script src="dark.js"></script>
    <!-- <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script> -->
  </head>
  <style type="text/css">
  	p {color:white;}
  	div {color:white;}
	body {background:black;}
	</style>
  <body>
    <!-- 为 ECharts 准备一个定义了宽高的 DOM -->
    <table width="1600" border="0" align="center">
<tr>
<td  colspan="2" >
	<input id="csv" type="file" style="background-color:white;">
	<span id="text4tip" style="background-color:white;color:red;font-weight:bold;font-size:large;">
	  &nbsp; 下载模板文件并导入可显示数据 
	</span>
	 &nbsp;
	<a href="mojiao_agg_daily_data.csv" style="color:white;">模板文件下载</a>
</td>
<td  colspan="1" align="right">
	<a href="http://81.69.251.251/echart_proj" style="color:white;">前往：  年度看板</a>
</td>
</tr>
<tr>
<td colspan="3" style="background-color:#8080ff;">
<h1 style="text-align: center;font-color:white;">陌生人社交平台日板</h1>
</td>
</tr>

<tr>
<td style="background-color:#000066;width:500px;vertical-align:top;">
	<div id="main_pp" style="width:500px;height:300px;font-color:white;"></div>
    <div id="main_pchat" style="width:500px;height:300px;"></div>
</td>
<td style="background-color:#000066;width:500px;height:600px;">
	<div id="upup" style="width:500px;height:600px;">
		<table border="0" align="center">
		<tr style="width:500px;height:40px;text-align:center;padding-top:0;margin-top:0">
	        <td colspan="2" style="width:500px;">
	        	<font style="font-size:large;font-weight:bold;">当日各项DAU情况</font>
	        	<br/>
	        	<font id="curr_date">2021年8月10日</font>
	        </td>
	    </tr>
		<tr style="width:500px;height:110px;text-align:center;">
	        <td id="td_dgmv" colspan="2" style="font-size:large;width:500px;">日消费GMV<br/>--</td>
	    </tr>
	    <tr style="width:500px;height:150px;text-align:center;">
	        <td id="td_game_dau" style="font-size:large;width:250px;">游戏日活<br/>--</td>
	        <td id="td_pchat_dau" style="font-size:large;width:250px;">私聊日活<br/>--</td>
	    </tr>
	  
	    <tr style="width:500px;height:150px;text-align:center;">
	        <td id="td_square_dau" style="font-size:large;width:250px;">广场日活<br/>--</td>
	        <td id="td_party_dau" style="font-size:large;width:250px;">派对日活<br/>--</td>
	    </tr>

	    <tr style="width:500px;height:150px;text-align:center;">
	        <td id="td_consume_dau" style="font-size:large;width:250px;">消费日活<br/>--</td>
	        <td id="td_referal_dau" style="font-size:large;width:250px;">推荐日活<br/>--</td>
	    </tr>    
		</table>
	</div>
		
</td>
<td style="background-color:#000066; width:600px;vertical-align:top;">
	<div id="main_square" style="width:600px;height:300px;"></div>
	<div id="main_game" style="width:600px;height:300px;"></div>
</td>
</tr>

<tr>
<td style="background-color:#000066;width:500px;vertical-align:top;">
	<div id="main_party_UV" style="width:500px;height:250px;"></div>
	<div id="nihao" style="width:500px;height:50px;text-align:center;font-size:large;background-color:#000033">Loading</div>
</td>
<td style="background-color:#eeeeee;width:500px;vertical-align:top;">
	<div id="main_DAU_dashboard" style="width:500px;height:500px;"></div>	
</td>
<td style="background-color:#000066;width:600px;vertical-align:top;">
	<div id="main_party" style="width: 600px;height:300px;"></div>
</td>
</tr>

<tr>
<td colspan="3" style="background-color:#FFA500;text-align:center;">
copyright © </td>
</table>
    
<script type="text/javascript">
var chartDom0 = document.getElementById('main_DAU_dashboard');
var myChart0= echarts.init(chartDom0, 'dark');
var option0;

option0 = {
	title: {
    text: '今日活跃用户'
  },
  series: [
    {
      type: 'gauge',
      startAngle: 180,
      endAngle: 0,
      min: 0,
      max: 1,
      splitNumber: 8,
      axisLine: {
        lineStyle: {
          width: 6,
          color: [
            [0.25, '#FF6E76'],
            [0.625, '#FF6E76'],
            [0.75, '#58D9F9'],
            [1, '#7CFFB2']
          ]
        }
      },
      pointer: {
        icon: 'path://M12.8,0.7l12,40.1H0.7L12.8,0.7z',
        length: '12%',
        width: 20,
        offsetCenter: [0, '-76%'],
        itemStyle: {
          color: 'auto'
        }
      },
      // axisTick: {
      //   length: 12,
      //   lineStyle: {
      //     color: 'auto',
      //     width: 2
      //   }
      // },
      // splitLine: {
      //   length: 20,
      //   lineStyle: {
      //     color: 'auto',
      //     width: 5
      //   }
      // },
      axisLabel: {
        color: '#ffffff',
        fontSize: 15,
        distance: -60,
        formatter: function (value) {
          if (value === 0.75) {
            return '正常';
          } else if (value === 0.625) {
            return '警戒';
          } else if (value === 0.875) {
            return '目标';
          }
          return '';
        }
      },
      title: {
        offsetCenter: [0, '-20%'],
        fontSize: 25
      },
      detail: {
        fontSize: 30,
        offsetCenter: [0, '0%'],
        valueAnimation: true,
        formatter: function (value) {
          return '达成 ' + Math.round(value * 100) + '%';
        },
        color: 'auto'
      },
      data: [
        {
          value: 0 / 70000,
          name: 'Loading'
        }
      ]
    }
  ]
};

option0 && myChart0.setOption(option0);


var chartDom1 = document.getElementById('main_pp');
var myChart1 = echarts.init(chartDom1,'dark');
var option1;

option1 = {
  title: {
    text: '个人主页漏斗'
  },
  tooltip: {
    trigger: 'item',
    formatter: '{a} <br/>{b} : {c}'
  },
  toolbox: {
    feature: {
      dataView: { readOnly: false },
      restore: {show:false},
      saveAsImage: {}
    }
  },
  legend: {
    data: ['曝光浏览', '点赞', '转发']
  },
  series: [
    {
      name: '当日情况',
      type: 'funnel',
      left: '10%',
      top: 60,
      bottom: 60,
      width: '80%',
      // min: 0,
      // max: 100,
      // minSize: '0%',
      // maxSize: '100%',
      sort: 'descending',
      gap: 2,
      label: {
        show: true,
        position: 'inside'
      },
      labelLine: {
        length: 10,
        lineStyle: {
          width: 1,
          type: 'solid'
        }
      },
      itemStyle: {
        borderColor: '#fff',
        borderWidth: 1
      },
      emphasis: {
        label: {
          fontSize: 20
        }
      },
      data: [
        { value: 0, name: '曝光浏览' },
        { value: 0, name: '点赞' },
        { value: 0, name: '转发' }
      ]
    }
  ]
};
option1 && myChart1.setOption(option1);

var chartDom2 = document.getElementById('main_pchat');
var myChart2 = echarts.init(chartDom2, 'dark');
var option2;

option2 = {
  title: {
    text: '私聊小功能使用',
    subtext: '单位 %',
    top: 10,
    left: 10
  },
  tooltip: {
    trigger: 'item',
  },
  legend: {
    type: 'scroll',
    bottom: 10,
    data: ['0']
  },
  // visualMap: {
  //   top: 'middle',
  //   right: 10,
  //   color: ['red', 'cyan'],
  //   calculable: true
  // },
  radar: {
    indicator: [
      { text: '发图贴纸', max: 80 },
      { text: '发图模板', max: 80 },
      { text: '语音变声', max: 80 },
      { text: '视频蒙面', max: 80 }
    ]
  },
  series: [
    {
      type: 'radar',
      lineStyle: {
        width: 1
      },
      data: [
        {
          value: [10, 20, 30, 40],
          name: '1'
        }
      ]
    }
  ]
};

option2 && myChart2.setOption(option2);

var chartDom3 = document.getElementById('main_party');
var myChart3 = echarts.init(chartDom3, 'dark');
var option3;

option3 = {
  title: {
    text: '派对数据',
  },
  tooltip: {
    trigger: 'axis',
    axisPointer: {
      type: 'cross',
      crossStyle: {
        color: '#999'
      }
    }
  },
  legend: {
    data: ['日均房间数', '房均时长','上麦率']
  },
  toolbox: {
    show: true,
    feature: {
      dataView: { show: true, readOnly: false },
      magicType: { show: true, type: ['line', 'bar'] },
      restore: { show: false },
      saveAsImage: { show: true }
    }
  },
  // calculable: true,
  xAxis: [
    {
      type: 'category',
      // prettier-ignore
      data: ['T-4', 'T-3', 'T-2', 'T-1', 'Today'],
      axisPointer: {
        type: 'shadow'
      }
    }
  ],
  yAxis: [
    {
      type: 'value',
      min: 0,
      max: 1000,
      axisLabel: {
        formatter: '{value} '
      }
    },
    {
      type: 'value',
      name: '%',
      min: 0,
      max: 100,
      axisLabel: {
        formatter: '{value} %'
      }
    }
  ],
  series: [
    {
      name: '日均房间数',
      type: 'bar',
      data: [0,0,0,0],
      markPoint: {
        data: [
          { type: 'max', name: 'Max' },
          { type: 'min', name: 'Min' }
        ]
      },
      markLine: {
        data: [{ type: 'average', name: 'Avg' }]
      }
    },
    {
      name: '房均时长',
      type: 'bar',
      data: [0,0,0,0],
      markPoint: {
        data: [
          { type: 'max', name: 'Max' },
          { type: 'min', name: 'Min' }
        ]
      },
      markLine: {
        data: [{ type: 'average', name: 'Avg' }]
      }
    },
    {
      name: '上麦率',
      type: 'line',
      yAxisIndex: 1,
      data: [0,0,0,0]
    }

  ]
};

option3 && myChart3.setOption(option3);

var chartDom4 = document.getElementById('main_square');
var myChart4 = echarts.init(chartDom4, 'dark');
var option4;

option4 = {
	title: {
    text: '广场动态数据'
  },
  legend: {},
  tooltip: {
      trigger: 'axis'
  },
  dataset: {
    source: [
      ['product', '发布量', '点赞量', '评论量', '收藏量','转发量'],
      ['T-4', 0, 0, 0, 0, 0],
      ['T-3', 0, 0, 0, 0, 0],
      ['T-2', 0, 0, 0, 0, 0],
      ['T-1', 0, 0, 0, 0, 0],
      ['Today', 0, 0, 0, 0, 0]
    ]
  },
  xAxis: { type: 'category' },
  yAxis: {},
  // Declare several bar series, each will be mapped
  // to a column of dataset.source by default.
  series: [{ type: 'line' }, { type: 'line' }, { type: 'line' }, { type: 'line' }, { type: 'line' }]
};

option4 && myChart4.setOption(option4);

var chartDom5 = document.getElementById('main_game');
var myChart5 = echarts.init(chartDom5, 'dark');
var option5;

option5 = {
	title: {
    text: '游戏活跃情况'
  },
  tooltip: {
    trigger: 'axis',
    axisPointer: {
      type: 'cross',
      crossStyle: {
        color: '#999'
      }
    }
  },
  legend: {
    data: ['发送邀请', '榜单查看', '签到', '人均游戏时长']
  },
  yAxis: [
    {
      type: 'category',
      data: ['T_2', 'T_1', 'Today'],
      axisPointer: {
        type: 'shadow'
      }
    }
  ],
  grid: { containLabel: true },
  xAxis: [{ name: '人次' }, { name: '分钟' }],
  series: [
    {
      tooltip: {
        valueFormatter: function (value) {
          return value + ' 人次';
        }
      },
      name: '发送邀请',
      type: 'bar',
      data: [0, 0, 0]
    },
    {
      tooltip: {
        valueFormatter: function (value) {
          return value + ' 人次';
        }
      },
      name: '榜单查看',
      type: 'bar',
      data: [0, 0, 0]
    },
    {
      tooltip: {
        valueFormatter: function (value) {
          return value + ' 人次';
        }
      },
      name: '签到',
      type: 'bar',
      data: [0, 0, 0]
    },
    {
      tooltip: {
        valueFormatter: function (value) {
          return value + ' 分钟';
        }
      },
      name: '人均游戏时长',
      type: 'bar',
      xAxisIndex: 1,
      data: [0, 0, 0]
    }
  ]
};

option5 && myChart5.setOption(option5);


var _panelImageURL = 'custom-gauge-panel.png';
var _animationDuration = 2000;
var _animationDurationUpdate = 2000;
var _animationEasingUpdate = 'quarticInOut';
var _valOnRadianMax = 10;
var _outerRadius = 90;
var _innerRadius = 70;
var _pointerInnerRadius = 10;
var _insidePanelRadius = 50;
var _currentDataIndex = 0;
function renderItem(params, api) {
  var valOnRadian = api.value(1);
  var coords = api.coord([api.value(0), valOnRadian]);
  var polarEndRadian = coords[3];
  var imageStyle = {
    image: _panelImageURL,
    x: params.coordSys.cx - _outerRadius,
    y: params.coordSys.cy - _outerRadius,
    width: _outerRadius * 2,
    height: _outerRadius * 2
  };
  return {
    type: 'group',
    children: [
      {
        type: 'image',
        style: imageStyle,
        clipPath: {
          type: 'sector',
          shape: {
            cx: params.coordSys.cx,
            cy: params.coordSys.cy,
            r: _outerRadius,
            r0: _innerRadius,
            startAngle: 0,
            endAngle: -polarEndRadian,
            transition: 'endAngle',
            enterFrom: { endAngle: 0 }
          }
        }
      },
      {
        type: 'image',
        style: imageStyle,
        clipPath: {
          type: 'polygon',
          shape: {
            points: makePionterPoints(params, polarEndRadian)
          },
          extra: {
            polarEndRadian: polarEndRadian,
            transition: 'polarEndRadian',
            enterFrom: { polarEndRadian: 0 }
          },
          during: function (apiDuring) {
            apiDuring.setShape(
              'points',
              makePionterPoints(params, apiDuring.getExtra('polarEndRadian'))
            );
          }
        }
      },
      {
        type: 'circle',
        shape: {
          cx: params.coordSys.cx,
          cy: params.coordSys.cy,
          r: _insidePanelRadius
        },
        style: {
          fill: '#fff',
          shadowBlur: 25,
          shadowOffsetX: 0,
          shadowOffsetY: 0,
          shadowColor: 'rgba(76,107,167,0.4)'
        }
      },
      {
        type: 'text',
        extra: {
          valOnRadian: valOnRadian,
          transition: 'valOnRadian',
          enterFrom: { valOnRadian: 0 }
        },
        style: {
          text: makeText(valOnRadian),
          fontSize: 30,
          fontWeight: 700,
          x: params.coordSys.cx,
          y: params.coordSys.cy,
          fill: 'rgb(0,50,190)',
          align: 'center',
          verticalAlign: 'middle',
          enterFrom: { opacity: 0 }
        },
        during: function (apiDuring) {
          apiDuring.setStyle(
            'text',
            makeText(apiDuring.getExtra('valOnRadian'))
          );
        }
      }
    ]
  };
}
function convertToPolarPoint(renderItemParams, radius, radian) {
  return [
    Math.cos(radian) * radius + renderItemParams.coordSys.cx,
    -Math.sin(radian) * radius + renderItemParams.coordSys.cy
  ];
}
function makePionterPoints(renderItemParams, polarEndRadian) {
  return [
    convertToPolarPoint(renderItemParams, _outerRadius, polarEndRadian),
    convertToPolarPoint(
      renderItemParams,
      _outerRadius,
      polarEndRadian + Math.PI * 0.03
    ),
    convertToPolarPoint(renderItemParams, _pointerInnerRadius, polarEndRadian)
  ];
}
function makeText(valOnRadian) {
  // Validate additive animation calc.
  if (valOnRadian < -10) {
    alert('illegal during val: ' + valOnRadian);
  }
  return ((valOnRadian / _valOnRadianMax) * 10).toFixed(0) ;
}
var chartDom6 = document.getElementById('main_party_UV');
var myChart6 = echarts.init(chartDom6, 'dark');
var option6;
option6 = {
	title: {
    text: '日均其他数据'
  },
  animationEasing: _animationEasingUpdate,
  animationDuration: _animationDuration,
  animationDurationUpdate: _animationDurationUpdate,
  animationEasingUpdate: _animationEasingUpdate,
  dataset: {
    source: [[0, 0]]
  },
  tooltip: {},
  angleAxis: {
    type: 'value',
    startAngle: 0,
    show: false,
    min: 0,
    max: _valOnRadianMax
  },
  radiusAxis: {
    type: 'value',
    show: false
  },
  polar: {},
  series: [
    {
      type: 'custom',
      coordinateSystem: 'polar',
      renderItem: renderItem
    }
  ]
};
option6 && myChart6.setOption(option6);



function csv2arr(csv_content){
	var arr = csv_content.split("\n");
	var results = [];
	for (var i=0;i<arr.length;i++){
		datalist = arr[i].split(",");
		results.push(datalist);
	}
	return results;
}
function get_last_record_value(csv_data_str, field_name, last_count=1){
	var arr_data = csv2arr(csv_data_str);
	var field_index = arr_data[0].indexOf(field_name);
	// var date_index = arr_data[0].indexOf(date_field_name);
	var value = Number(arr_data[arr_data.length - 1 - last_count][field_index]);
	return value;

}
function get_last_record_original_value(csv_data_str, field_name, last_count=1){
	var arr_data = csv2arr(csv_data_str);
	var field_index = arr_data[0].indexOf(field_name);
	// var date_index = arr_data[0].indexOf(date_field_name);
	var value = arr_data[arr_data.length - 1 - last_count][field_index];
	return value;
}
function cal_month_field_agg(csv_data_str, field_name_list, month="100000000000", date_field_name="Date"){
	var arr_data = csv2arr(csv_data_str);
	var field_index_list = [];
	for (var i=0; i<field_name_list.length;i++){
		field_index_list.push(arr_data[0].indexOf(field_name_list[i]))
	}
	
	var date_index = arr_data[0].indexOf(date_field_name);
	var months = [];
	for (var i=1;i<13;i++){
		if (month.charAt(i-1) == '1'){
			if (i <= 9){
				months.push('0' + String(i));
			}else{
				months.push(String(i));
			}
			
		}
	}
	// console.log(months);
	var row_count = 0;
	var amount_sum = [];
	for (var j=0;j<field_index_list.length;j++){
		amount_sum.push(0);
	}
	var resultObject = new Object();
	for (var i=1;i<arr_data.length;i++){
		if (months.indexOf(arr_data[i][date_index].split("-")[1]) > -1){
			row_count += 1;
			for (var j=0;j<field_index_list.length;j++){
				var temp_value = Number(arr_data[i][field_index_list[j]]);
				amount_sum[j] += temp_value;
			}
			
		}
	}
	var amount_avg = [];
	for (var j=0;j<field_index_list.length;j++){
		amount_avg.push(amount_sum[j] / row_count);
	}

	resultObject.row_count = row_count;
	resultObject.amount_sum = amount_sum;
	resultObject.amount_avg = amount_avg;
	return resultObject;
}
function cal_quarter_field_agg(csv_data_str, field_name, quarter="0001", date_field_name="Date"){
	var arr_data = csv2arr(csv_data_str);
	var field_index = arr_data[0].indexOf(field_name);
	var date_index = arr_data[0].indexOf(date_field_name);
	// 根据quarter属性生成可用月份列表
	var months = [];
	if (quarter.charAt(0) == '1'){
		months.push("01");
		months.push("02");
		months.push("03");
	}
	if (quarter.charAt(1) == '1'){
		months.push("04");
		months.push("05");
		months.push("06");
	}
	if (quarter.charAt(2) == '1'){
		months.push("07");
		months.push("08");
		months.push("09");
	}
	if (quarter.charAt(3) == '1'){
		months.push("10");
		months.push("11");
		months.push("12");
	}
	var row_count = 0;
	var amount_sum = 0;
	var resultObject = new Object();
	for (var i=1;i<arr_data.length;i++){
		if (months.indexOf(arr_data[i][date_index].split("-")[1]) > -1){
			row_count += 1;
			var temp_value = Number(arr_data[i][field_index]);
			amount_sum += temp_value;
		}
	}

	resultObject.row_count = row_count;
	resultObject.amount_sum = amount_sum;
	resultObject.amount_avg = amount_sum / row_count;
	return resultObject;

		

}
var fileInput = document.getElementById("csv");
var csv_file_content;
var dd;
readFile = function () {
    var reader = new FileReader();
    reader.onload = function () {
        
        csv_file_content = reader.result;
        var test_dd = cal_quarter_field_agg(csv_file_content, "avg_rounds", quarter="1111");
        // document.getElementById("out").innerHTML = test_dd;
        // console.log(test_dd);

        // 私聊小功能数据 刷新

        var sticker_rate_t = get_last_record_original_value(csv_file_content, 'sticker_rate', last_count=1);
        var templates_rate_t = get_last_record_original_value(csv_file_content, 'templates_rate', last_count=1);
        var magic_voice_rate_t = get_last_record_original_value(csv_file_content, 'magic_voice_rate', last_count=1);
        var fake_face_rate_t = get_last_record_original_value(csv_file_content, 'fake_face_rate', last_count=1);

        var sticker_rate_t3 = get_last_record_original_value(csv_file_content, 'sticker_rate', last_count=3);
        var templates_rate_t3 = get_last_record_original_value(csv_file_content, 'templates_rate', last_count=3);
        var magic_voice_rate_t3 = get_last_record_original_value(csv_file_content, 'magic_voice_rate', last_count=3);
        var fake_face_rate_t3 = get_last_record_original_value(csv_file_content, 'fake_face_rate', last_count=3);

        var sticker_rate_t2 = get_last_record_original_value(csv_file_content, 'sticker_rate', last_count=2);
        var templates_rate_t2 = get_last_record_original_value(csv_file_content, 'templates_rate', last_count=2);
        var magic_voice_rate_t2 = get_last_record_original_value(csv_file_content, 'magic_voice_rate', last_count=2);
        var fake_face_rate_t2 = get_last_record_original_value(csv_file_content, 'fake_face_rate', last_count=2);

        var d1 = get_last_record_original_value(csv_file_content, 'Date', last_count=1);
        var d2 = get_last_record_original_value(csv_file_content, 'Date', last_count=2);
        var d3 = get_last_record_original_value(csv_file_content, 'Date', last_count=3);
        var d4 = get_last_record_original_value(csv_file_content, 'Date', last_count=4);
        var d5 = get_last_record_original_value(csv_file_content, 'Date', last_count=5);
        var daylist = [];
        daylist.push(d1.substr(8,2) + '日');
        daylist.push(d2.substr(8,2) + '日');
        daylist.push(d3.substr(8,2) + '日');
        daylist.push(d4.substr(8,2) + '日');
        daylist.push(d5.substr(8,2) + '日');


      	// console.log(mon_data);
        myChart2.setOption({
		  legend: {
		    // type: 'scroll',
		    bottom: 10,
		    data: (function () {
		      var list = [];
		      for (var i = 0; i <= daylist.length; i++) {
		        list.push(daylist[i]);
		      }
		      return list;
		    })()
		  },

		  series: [
			  		{
				      type: 'radar',
				      lineStyle: {
				        width: 1
				      },
				      data: [
				        {
				          value: [sticker_rate_t, templates_rate_t, magic_voice_rate_t, fake_face_rate_t],
				          name: daylist[0]
				        }
				      ]
				    },
				    {
				      type: 'radar',
				      lineStyle: {
				        width: 1
				      },
				      data: [
				        {
				          value: [sticker_rate_t2, templates_rate_t2, magic_voice_rate_t2, fake_face_rate_t2],
          				  name: daylist[1]
				        }
				      ]
				    },
				    {
				      type: 'radar',
				      lineStyle: {
				        width: 1
				      },
				      data: [
				        {
				          value: [sticker_rate_t3, templates_rate_t3, magic_voice_rate_t3, fake_face_rate_t3],
				          name: daylist[2]
				        }
				      ]
				    },
        	]
		});
        // 个人主页漏斗数据刷新
        var pp_views = get_last_record_original_value(csv_file_content, 'pp_views', last_count=1);
        var pp_likes = get_last_record_original_value(csv_file_content, 'pp_likes', last_count=1);
        var pp_forwards = get_last_record_original_value(csv_file_content, 'pp_forwards', last_count=1);
        myChart1.setOption({
		    series: [
			    {
			      name: '日期：' + get_last_record_original_value(csv_file_content, 'Date', last_count=1).substr(0,10),
			      data: [
			        { value: pp_views, name: '曝光浏览' },
			        { value: pp_likes, name: '点赞' },
			        { value: pp_forwards, name: '转发' }
			      ]
			    }
			  ]
		});

		// 日均其他数据
		var today_room_uv = get_last_record_original_value(csv_file_content, "room_uv", last_count=1);
		var today_avg_rounds = get_last_record_original_value(csv_file_content, "avg_rounds", last_count=1);
		var today_avg_voice = get_last_record_original_value(csv_file_content, "avg_voice", last_count=1);
		var today_avg_video = get_last_record_original_value(csv_file_content, "avg_video", last_count=1);
		var today_rcomments = get_last_record_original_value(csv_file_content, "random_comments", last_count=1);
		var today_hcomments = get_last_record_original_value(csv_file_content, "host_comments", last_count=1);
		var host_reply_rate = today_hcomments / today_rcomments * 100;

		setInterval(function () {
			var data_list = [today_room_uv, today_avg_rounds, 
			today_avg_video, today_avg_voice, host_reply_rate];
			var idx = Math.floor(Math.random()*data_list.length);
			var name_list = ['派对房间UV (人次/天)','人均游戏局数 ','人均视频时长 (min/天)',
			'人均语音通话时长 (min/天)', '楼主回复率 %'];
		  var nextSource = [[1, data_list[idx]]];
		  myChart6.setOption({
		    dataset: {
		      source: nextSource
		    }
		  });
		  document.getElementById("nihao").innerHTML = name_list[idx];
		}, 2000);

		// 派对数据 刷新

		var room_num_t1 = get_last_record_original_value(csv_file_content, 'room_num', last_count=1);
		var room_num_t2 = get_last_record_original_value(csv_file_content, 'room_num', last_count=2);
		var room_num_t3 = get_last_record_original_value(csv_file_content, 'room_num', last_count=3);
		var room_num_t4 = get_last_record_original_value(csv_file_content, 'room_num', last_count=4);
		var room_num_t5 = get_last_record_original_value(csv_file_content, 'room_num', last_count=5);

		var room_time_t1 = Number(get_last_record_original_value(csv_file_content, 'room_time', last_count=1)).toFixed(1);
		var room_time_t2 = Number(get_last_record_original_value(csv_file_content, 'room_time', last_count=2)).toFixed(1);
		var room_time_t3 = Number(get_last_record_original_value(csv_file_content, 'room_time', last_count=3)).toFixed(1);
		var room_time_t4 = Number(get_last_record_original_value(csv_file_content, 'room_time', last_count=4)).toFixed(1);
		var room_time_t5 = Number(get_last_record_original_value(csv_file_content, 'room_time', last_count=5)).toFixed(1);

		var mike_rate_t1 = Number(get_last_record_original_value(csv_file_content, 'mike_rate', last_count=1)).toFixed(1);
		var mike_rate_t2 = Number(get_last_record_original_value(csv_file_content, 'mike_rate', last_count=2)).toFixed(1);
		var mike_rate_t3 = Number(get_last_record_original_value(csv_file_content, 'mike_rate', last_count=3)).toFixed(1);
		var mike_rate_t4 = Number(get_last_record_original_value(csv_file_content, 'mike_rate', last_count=4)).toFixed(1);
		var mike_rate_t5 = Number(get_last_record_original_value(csv_file_content, 'mike_rate', last_count=5)).toFixed(1);

		myChart3.setOption({
			xAxis: [
			    {
			      type: 'category',
			      // prettier-ignore
			      data: [daylist[4], daylist[3], daylist[2], daylist[1], daylist[0]],
			      axisPointer: {
			        type: 'shadow'
			      }
			    }
			  ],
		    series: [
			    {
			     tooltip: {
			        valueFormatter: function (value) {
			          return value + ' 个';
			        }
			      },
			      name: '日均房间数',
			      type: 'bar',
			      data: [room_num_t5, room_num_t4, room_num_t3, room_num_t2, room_num_t1],
			      markPoint: {
			        data: [
			          { type: 'max', name: 'Max' },
			          { type: 'min', name: 'Min' }
			        ]
			      },
			      markLine: {
			        data: [{ type: 'average', name: 'Avg' }]
			      }
			    },
			    {
			    tooltip: {
			        valueFormatter: function (value) {
			          return value + ' 分钟';
			        }
			      },
			      name: '房均时长',
			      type: 'bar',
			      data: [room_time_t5, room_time_t4, room_time_t3, room_time_t2, room_time_t1],
			      markPoint: {
			        data: [
			          { type: 'max', name: 'Max' },
			          { type: 'min', name: 'Min' }
			        ]
			      },
			      markLine: {
			        data: [{ type: 'average', name: 'Avg' }]
			      }
			    },
			    {
			    	tooltip: {
			        valueFormatter: function (value) {
			          return value + ' %';
			        }
			      },
			      name: '上麦率',
			      type: 'line',
			      data: [mike_rate_t5, mike_rate_t4, mike_rate_t3, mike_rate_t2, mike_rate_t1]
			    }
			  ]
		});

		// 游戏活跃情况 刷新

		// 近3日 发送邀请 获取
		var game_invitation_t = get_last_record_original_value(csv_file_content, 'game_invitation', last_count=1);
		var game_invitation_t_1 = get_last_record_original_value(csv_file_content, 'game_invitation', last_count=2);
		var game_invitation_t_2 = get_last_record_original_value(csv_file_content, 'game_invitation', last_count=3);

		var game_board_view_t = get_last_record_original_value(csv_file_content, 'game_board_view', last_count=1);
		var game_board_view_t_1 = get_last_record_original_value(csv_file_content, 'game_board_view', last_count=2);
		var game_board_view_t_2 = get_last_record_original_value(csv_file_content, 'game_board_view', last_count=3);

		var game_attendance_t = get_last_record_original_value(csv_file_content, 'game_attendance', last_count=1);
		var game_attendance_t_1 = get_last_record_original_value(csv_file_content, 'game_attendance', last_count=2);
		var game_attendance_t_2 = get_last_record_original_value(csv_file_content, 'game_attendance', last_count=3);

		var avg_gametime_t = Number(get_last_record_original_value(csv_file_content, 'avg_gametime', last_count=1)).toFixed(1);
		var avg_gametime_t_1 = Number(get_last_record_original_value(csv_file_content, 'avg_gametime', last_count=2)).toFixed(1);
		var avg_gametime_t_2 = Number(get_last_record_original_value(csv_file_content, 'avg_gametime', last_count=3)).toFixed(1);



		myChart5.setOption({
			  yAxis: [
			    {
			      type: 'category',
			      data: [daylist[0], daylist[1], daylist[2]],
			      axisPointer: {
			        type: 'shadow'
			      }
			    }
			  ],
			  series: [
			    {
			      tooltip: {
			        valueFormatter: function (value) {
			          return value + ' 人次';
			        }
			      },
			      name: '发送邀请',
			      type: 'bar',
			      data: [game_invitation_t, game_invitation_t_1, game_invitation_t_2]
			    },
			    {
			      tooltip: {
			        valueFormatter: function (value) {
			          return value + ' 人次';
			        }
			      },
			      name: '榜单查看',
			      type: 'bar',
			      data: [game_board_view_t, game_board_view_t_1, game_board_view_t_2]
			    },
			    {
			      tooltip: {
			        valueFormatter: function (value) {
			          return value + ' 人次';
			        }
			      },
			      name: '签到',
			      type: 'bar',
			      data: [game_attendance_t, game_attendance_t_1, game_attendance_t_2]
			    },
			    {
			      tooltip: {
			        valueFormatter: function (value) {
			          return value + ' 分钟';
			        }
			      },
			      name: '人均游戏时长',
			      type: 'bar',
			      xAxisIndex: 1,
			      data: [avg_gametime_t, avg_gametime_t_1, avg_gametime_t_2]
			    }
			  ]
			});

		// 本年度平均DAU 刷新
		var today_dau = get_last_record_original_value(csv_file_content, 'dau', last_count=1);
		myChart0.setOption({
		    series: [
			    {
			      data: [
			        {
			          value: Number(today_dau / 70000),
			          name: '今日DAU ' + String(Math.round(today_dau))
			        }
			      ]
			    }
			  ]
		});

		// 广场数据 刷新
		// 获取最后5条记录的日期
		var T_date = get_last_record_original_value(csv_file_content, 'Date', last_count=1);
		var T_1_date = get_last_record_original_value(csv_file_content, 'Date', last_count=2);
		var T_2_date = get_last_record_original_value(csv_file_content, 'Date', last_count=3);
		var T_3_date = get_last_record_original_value(csv_file_content, 'Date', last_count=4);
		var T_4_date = get_last_record_original_value(csv_file_content, 'Date', last_count=5);

		// 近5日发布量获取
		var post_t = get_last_record_original_value(csv_file_content, 'posts', last_count=1);
		var post_t_1 = get_last_record_original_value(csv_file_content, 'posts', last_count=2);
		var post_t_2 = get_last_record_original_value(csv_file_content, 'posts', last_count=3);
		var post_t_3 = get_last_record_original_value(csv_file_content, 'posts', last_count=4);
		var post_t_4 = get_last_record_original_value(csv_file_content, 'posts', last_count=5);

		// 近5日点赞量获取
		var like_t = get_last_record_original_value(csv_file_content, 'likes', last_count=1);
		var like_t_1 = get_last_record_original_value(csv_file_content, 'likes', last_count=2);
		var like_t_2 = get_last_record_original_value(csv_file_content, 'likes', last_count=3);
		var like_t_3 = get_last_record_original_value(csv_file_content, 'likes', last_count=4);
		var like_t_4 = get_last_record_original_value(csv_file_content, 'likes', last_count=5);

		// 近5日评论量获取
		var random_comment_t = get_last_record_original_value(csv_file_content, 'random_comments', last_count=1);
		var random_comment_t_1 = get_last_record_original_value(csv_file_content, 'random_comments', last_count=2);
		var random_comment_t_2 = get_last_record_original_value(csv_file_content, 'random_comments', last_count=3);
		var random_comment_t_3 = get_last_record_original_value(csv_file_content, 'random_comments', last_count=4);
		var random_comment_t_4 = get_last_record_original_value(csv_file_content, 'random_comments', last_count=5);

		// 近5日收藏量获取
		var collect_t = get_last_record_original_value(csv_file_content, 'collects', last_count=1);
		var collect_t_1 = get_last_record_original_value(csv_file_content, 'collects', last_count=2);
		var collect_t_2 = get_last_record_original_value(csv_file_content, 'collects', last_count=3);
		var collect_t_3 = get_last_record_original_value(csv_file_content, 'collects', last_count=4);
		var collect_t_4 = get_last_record_original_value(csv_file_content, 'collects', last_count=5);

		// 近5日转发量获取
		var forward_t = get_last_record_original_value(csv_file_content, 'forwards', last_count=1);
		var forward_t_1 = get_last_record_original_value(csv_file_content, 'forwards', last_count=2);
		var forward_t_2 = get_last_record_original_value(csv_file_content, 'forwards', last_count=3);
		var forward_t_3 = get_last_record_original_value(csv_file_content, 'forwards', last_count=4);
		var forward_t_4 = get_last_record_original_value(csv_file_content, 'forwards', last_count=5);

		myChart4.setOption({
		    dataset: {
		      source: [
		      ['product', '发布量', '点赞量', '评论量', '收藏量','转发量'],
		      [T_4_date.substr(0,10), post_t_4, like_t_4, random_comment_t_4, collect_t_4, forward_t_4],
		      [T_3_date.substr(0,10), post_t_3, like_t_3, random_comment_t_3, collect_t_3, forward_t_3],
		      [T_2_date.substr(0,10), post_t_2, like_t_2, random_comment_t_2, collect_t_2, forward_t_2],
		      [T_1_date.substr(0,10), post_t_1, like_t_1, random_comment_t_1, collect_t_1, forward_t_1],
		      [T_date.substr(0,10),   post_t,   like_t,   random_comment_t,   collect_t,   forward_t]
		    ]}
		  });


		// 细分日活及 日消费GMV
		var value_game_dau = get_last_record_value(csv_file_content, "game_dau", last_count=1);
		var value_game_dau_2 = get_last_record_value(csv_file_content, "game_dau", last_count=2);

		var value_square_dau = get_last_record_value(csv_file_content, "square_dau", last_count=1);
		var value_square_dau_2 = get_last_record_value(csv_file_content, "square_dau", last_count=2);

		var value_pchat_dau = get_last_record_value(csv_file_content, "pchat_dau", last_count=1);
		var value_pchat_dau_2 = get_last_record_value(csv_file_content, "pchat_dau", last_count=2);

		var value_party_dau = get_last_record_value(csv_file_content, "party_dau", last_count=1);
		var value_party_dau_2 = get_last_record_value(csv_file_content, "party_dau", last_count=2);

		var value_referal_dau = get_last_record_value(csv_file_content, "referal_dau", last_count=1);
		var value_referal_dau_2 = get_last_record_value(csv_file_content, "referal_dau", last_count=2);
	
		var value_consume_dau = get_last_record_value(csv_file_content, "consume_dau", last_count=1);
		var value_consume_dau_2 = get_last_record_value(csv_file_content, "consume_dau", last_count=2);

		var value_dgmv = get_last_record_value(csv_file_content, "dgmv", last_count=1);
		var value_dgmv_2 = get_last_record_value(csv_file_content, "dgmv", last_count=2);

		var diff_square_dau = value_square_dau - value_square_dau_2;
		if (diff_square_dau > 0){
			document.getElementById("td_square_dau").innerHTML = "广场日活<br/>" + String(Math.round(value_square_dau)) 
			+ '<img style="width:30px;" src="arrow-up-filling.svg"/>' + Math.round(diff_square_dau);
		}
		else{
			document.getElementById("td_square_dau").innerHTML = "广场日活<br/>" + String(Math.round(value_square_dau)) 
			+ '<img style="width:30px;" src="arrow-down-filling.svg"/>' + Math.round(diff_square_dau);
		}

		var diff_pchat_dau = value_pchat_dau - value_pchat_dau_2;
		if (diff_pchat_dau > 0){
			document.getElementById("td_pchat_dau").innerHTML = "私聊日活<br/>" + String(Math.round(value_pchat_dau)) 
			+ '<img style="width:30px;" src="arrow-up-filling.svg"/>' + Math.round(diff_pchat_dau);
		}
		else{
			document.getElementById("td_pchat_dau").innerHTML = "私聊日活<br/>" + String(Math.round(value_pchat_dau)) 
			+ '<img style="width:30px;" src="arrow-down-filling.svg"/>' + Math.round(diff_pchat_dau);
		}

		var diff_party_dau = value_party_dau - value_party_dau_2;
		if (diff_party_dau > 0){
			document.getElementById("td_party_dau").innerHTML = "派对日活<br/>" + String(Math.round(value_party_dau)) 
			+ '<img style="width:30px;" src="arrow-up-filling.svg"/>' + Math.round(diff_party_dau);
		}
		else{
			document.getElementById("td_party_dau").innerHTML = "派对日活<br/>" + String(Math.round(value_party_dau)) 
			+ '<img style="width:30px;" src="arrow-down-filling.svg"/>' + Math.round(diff_party_dau);
		}

		var diff_consume_dau = value_consume_dau - value_consume_dau_2;
		if (diff_consume_dau > 0){
			document.getElementById("td_consume_dau").innerHTML = "消费日活<br/>" + String(Math.round(value_consume_dau)) 
			+ '<img style="width:30px;" src="arrow-up-filling.svg"/>' + Math.round(diff_consume_dau);
		}
		else{
			document.getElementById("td_consume_dau").innerHTML = "消费日活<br/>" + String(Math.round(value_consume_dau)) 
			+ '<img style="width:30px;" src="arrow-down-filling.svg"/>' + Math.round(diff_consume_dau);
		}

		var diff_referal_dau = value_referal_dau - value_referal_dau_2;
		if (diff_referal_dau > 0){
			document.getElementById("td_referal_dau").innerHTML = "推荐日活<br/>" + String(Math.round(value_referal_dau)) 
			+ '<img style="width:30px;" src="arrow-up-filling.svg"/>' + Math.round(diff_referal_dau);
		}
		else{
			document.getElementById("td_referal_dau").innerHTML = "推荐日活<br/>" + String(Math.round(value_referal_dau)) 
			+ '<img style="width:30px;" src="arrow-down-filling.svg"/>' + Math.round(diff_referal_dau);
		}

		var diff_game_dau = value_game_dau - value_game_dau_2;
		if (diff_game_dau > 0){
			document.getElementById("td_game_dau").innerHTML = "游戏日活<br/>" + String(Math.round(value_game_dau)) 
			+ '<img style="width:30px;" src="arrow-up-filling.svg"/>' + Math.round(diff_game_dau);
		}
		else{
			document.getElementById("td_game_dau").innerHTML = "游戏日活<br/>" + String(Math.round(value_game_dau)) 
			+ '<img style="width:30px;" src="arrow-down-filling.svg"/>' + Math.round(diff_game_dau);
		}

		var diff_dgmv = value_dgmv - value_dgmv_2;
		if (diff_dgmv > 0){
			document.getElementById("td_dgmv").innerHTML = "日消费GMV<br/>" + String(Math.round(value_dgmv)) 
			+ '<img style="width:30px;" src="arrow-up-filling.svg"/>' + Math.round(diff_dgmv);
		}
		else{
			document.getElementById("td_dgmv").innerHTML = "日消费GMV<br/>" + String(Math.round(value_dgmv)) 
			+ '<img style="width:30px;" src="arrow-down-filling.svg"/>' + Math.round(diff_dgmv);
		}

		// 填充最后一条记录的日期
		var curr_date = get_last_record_original_value(csv_file_content, 'Date', last_count=1);
		document.getElementById("curr_date").innerHTML = curr_date.substr(0,10);



    };
    // start reading the file. When it is done, calls the onload event defined above.
    // reader.readAsBinaryString(fileInput.files[0]);
    reader.readAsText(fileInput.files[0]);
};

fileInput.addEventListener('change', readFile);

window.onload = function () { //里面放需要加载的js


  };


</script>


  </body>
</html>