<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Stranger Social Year Statement</title>
    <!-- 引入刚刚下载的 ECharts 文件 -->
    <script src="echarts.js"></script>
    <script src="dark.js"></script>
    <!-- <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script> -->
  </head>
  <style type="text/css">
  	p {color:white;}
  	div {color:white;}
	body {background:black;}
	</style>
  <body>
    <!-- 为 ECharts 准备一个定义了宽高的 DOM -->
    <table width="1600" border="0" align="center">
<tr>
<td  colspan="2" >
	<input id="csv" type="file" style="background-color:white;">
	<span id="text4tip" style="background-color:white;color:red;font-weight:bold;font-size:large;">
	  &nbsp; 下载模板文件并导入可显示数据 
	</span>
	 &nbsp;
	<a href="mojiao_agg_daily_data.csv" style="color:white;">模板文件下载</a>
</td>
<td  colspan="1" align="right">
	<a href="./day.html" style="color:white;">前往：  日指标看板</a>
</td>
</tr>
<tr>
<td colspan="3" style="background-color:#8080ff;">
<h1 style="text-align: center;font-color:white;">陌生人社交平台年度看板</h1>
</td>
</tr>

<tr>
<td style="background-color:#000066;width:500px;vertical-align:top;">
	<div id="main_pp" style="width:500px;height:300px;font-color:white;"></div>
    <div id="main_pchat" style="width:500px;height:300px;"></div>
</td>
<td style="background-color:#000066;width:500px;height:600px;">
	<div id="upup" style="width:500px;height:600px;">
		<table border="0" align="center">
		<tr style="width:500px;height:40px;text-align:center;padding-top:0;margin-top:0">
	        <td colspan="2" style="width:500px;">
	        	<font style="font-size:large;font-weight:bold;">今年各细分活跃情况</font>
	        	<br/>
	        	<font id="curr_date">2021年8月10日</font>
	        </td>
	    </tr>
		<tr style="width:500px;height:110px;text-align:center;">
	        <td id="td_dgmv" colspan="2" style="font-size:x-large;width:500px;">总消费GMV<br/>--</td>
	    </tr>
	    <tr style="width:500px;height:150px;text-align:center;">
	        <td id="td_game_dau" style="font-size:x-large;width:250px;">游戏<br/>--</td>
	        <td id="td_pchat_dau" style="font-size:x-large;width:250px;">私聊<br/>--</td>
	    </tr>
	  
	    <tr style="width:500px;height:150px;text-align:center;">
	        <td id="td_square_dau" style="font-size:x-large;width:250px;">广场<br/>--</td>
	        <td id="td_party_dau" style="font-size:x-large;width:250px;">派对<br/>--</td>
	    </tr>

	    <tr style="width:500px;height:150px;text-align:center;">
	        <td id="td_consume_dau" style="font-size:x-large;width:250px;">消费<br/>--</td>
	        <td id="td_referal_dau" style="font-size:x-large;width:250px;">推荐<br/>--</td>
	    </tr>    
		</table>
	</div>
		
</td>
<td style="background-color:#000066; width:600px;vertical-align:top;">
	<div id="main_square" style="width:600px;height:300px;"></div>
	<div id="main_game" style="width:600px;height:300px;"></div>
</td>
</tr>

<tr>
<td style="background-color:#000066;width:500px;vertical-align:top;">
	<div id="main_party_UV" style="width:500px;height:250px;"></div>
	<div id="nihao" style="width:500px;height:50px;text-align:center;font-size:large;background-color:#000033">Loading</div>
</td>
<td style="background-color:#eeeeee;width:500px;vertical-align:top;">
	<div id="main_DAU_dashboard" style="width:500px;height:500px;"></div>	
</td>
<td style="background-color:#000066;width:600px;vertical-align:top;">
	<div id="main_party" style="width: 600px;height:300px;"></div>
</td>
</tr>

<tr>
<td colspan="3" style="background-color:#FFA500;text-align:center;">
copyright © </td>
</table>
    
<script type="text/javascript">
var chartDom0 = document.getElementById('main_DAU_dashboard');
var myChart0= echarts.init(chartDom0, 'dark');
var option0;

option0 = {
	title: {
    text: '本年度平均DAU'
  },
  series: [
    {
      type: 'gauge',
      startAngle: 180,
      endAngle: 0,
      min: 0,
      max: 1,
      splitNumber: 8,
      axisLine: {
        lineStyle: {
          width: 6,
          color: [
            [0.25, '#FF6E76'],
            [0.625, '#FF6E76'],
            [0.75, '#58D9F9'],
            [1, '#7CFFB2']
          ]
        }
      },
      pointer: {
        icon: 'path://M12.8,0.7l12,40.1H0.7L12.8,0.7z',
        length: '12%',
        width: 20,
        offsetCenter: [0, '-76%'],
        itemStyle: {
          color: 'auto'
        }
      },
      // axisTick: {
      //   length: 12,
      //   lineStyle: {
      //     color: 'auto',
      //     width: 2
      //   }
      // },
      // splitLine: {
      //   length: 20,
      //   lineStyle: {
      //     color: 'auto',
      //     width: 5
      //   }
      // },
      axisLabel: {
        color: '#ffffff',
        fontSize: 15,
        distance: -60,
        formatter: function (value) {
          if (value === 0.75) {
            return '正常';
          } else if (value === 0.625) {
            return '警戒';
          } else if (value === 0.875) {
            return '目标';
          }
          return '';
        }
      },
      title: {
        offsetCenter: [0, '-20%'],
        fontSize: 25
      },
      detail: {
        fontSize: 30,
        offsetCenter: [0, '0%'],
        valueAnimation: true,
        formatter: function (value) {
          return '达成 ' + Math.round(value * 100) + '%';
        },
        color: 'auto'
      },
      data: [
        {
          value: 0 / 70000,
          name: '平均DAU 0'
        }
      ]
    }
  ]
};

option0 && myChart0.setOption(option0);


var chartDom1 = document.getElementById('main_pp');
var myChart1 = echarts.init(chartDom1,'dark');
var option1;

option1 = {
  title: {
    text: '个人主页漏斗'
  },
  tooltip: {
    trigger: 'item',
    formatter: '{a} <br/>{b} : {c}'
  },
  toolbox: {
    feature: {
      dataView: { readOnly: false },
      restore: {show:false},
      saveAsImage: {}
    }
  },
  legend: {
    data: ['曝光浏览', '点赞', '转发']
  },
  series: [
    {
      name: '全年日均',
      type: 'funnel',
      left: '10%',
      top: 60,
      bottom: 60,
      width: '80%',
      // min: 0,
      // max: 100,
      // minSize: '0%',
      // maxSize: '100%',
      sort: 'descending',
      gap: 2,
      label: {
        show: true,
        position: 'inside'
      },
      labelLine: {
        length: 10,
        lineStyle: {
          width: 1,
          type: 'solid'
        }
      },
      itemStyle: {
        borderColor: '#fff',
        borderWidth: 1
      },
      emphasis: {
        label: {
          fontSize: 20
        }
      },
      data: [
        { value: 0, name: '曝光浏览' },
        { value: 0, name: '点赞' },
        { value: 0, name: '转发' }
      ]
    }
  ]
};
option1 && myChart1.setOption(option1);

var chartDom2 = document.getElementById('main_pchat');
var myChart2 = echarts.init(chartDom2, 'dark');
var option2;

option2 = {
  title: {
    text: '私聊小功能使用',
    subtext: '单位 %',
    top: 10,
    left: 10
  },
  tooltip: {
    trigger: 'item',
  },
  legend: {
    type: 'scroll',
    bottom: 10,
    data: ['0']
  },
  visualMap: {
    top: 'middle',
    right: 10,
    color: ['red', 'cyan'],
    calculable: true
  },
  radar: {
    indicator: [
      { text: '发图贴纸', max: 80 },
      { text: '发图模板', max: 80 },
      { text: '语音变声', max: 80 },
      { text: '视频蒙面', max: 80 }
    ]
  },
  series: [
    {
      type: 'radar',
      lineStyle: {
        width: 1
      },
      data: [
        {
          value: [10, 20, 30, 40],
          name: '1'
        }
      ]
    }
  ]
};

option2 && myChart2.setOption(option2);

var chartDom3 = document.getElementById('main_party');
var myChart3 = echarts.init(chartDom3, 'dark');
var option3;

option3 = {
  title: {
    text: '派对数据',
    subtext: ' --- '
  },
  tooltip: {
    trigger: 'axis',
    axisPointer: {
      type: 'cross',
      crossStyle: {
        color: '#999'
      }
    }
  },
  legend: {
    data: ['日均房间数', '房均时长 min','上麦率']
  },
  toolbox: {
    show: true,
    feature: {
      dataView: { show: true, readOnly: false },
      magicType: { show: true, type: ['line', 'bar'] },
      restore: { show: false },
      saveAsImage: { show: true }
    }
  },
  // calculable: true,
  xAxis: [
    {
      type: 'category',
      // prettier-ignore
      data: ['Q1', 'Q2', 'Q3', 'Q4'],
      axisPointer: {
        type: 'shadow'
      }
    }
  ],
  yAxis: [
    {
      type: 'value',
      min: 0,
      max: 1000,
      axisLabel: {
        formatter: '{value} '
      }
    },
    {
      type: 'value',
      name: '%',
      min: 0,
      max: 100,
      axisLabel: {
        formatter: '{value} %'
      }
    }
  ],
  series: [
    {
      name: '日均房间数',
      type: 'bar',
      data: [0,0,0,0],
      markPoint: {
        data: [
          { type: 'max', name: 'Max' },
          { type: 'min', name: 'Min' }
        ]
      },
      markLine: {
        data: [{ type: 'average', name: 'Avg' }]
      }
    },
    {
      name: '房均时长 min',
      type: 'bar',
      data: [0,0,0,0],
      markPoint: {
        data: [
          { type: 'max', name: 'Max' },
          { type: 'min', name: 'Min' }
        ]
      },
      markLine: {
        data: [{ type: 'average', name: 'Avg' }]
      }
    },
    {
      name: '上麦率',
      type: 'line',
      yAxisIndex: 1,
      data: [0,0,0,0]
    }

  ]
};

option3 && myChart3.setOption(option3);

var chartDom4 = document.getElementById('main_square');
var myChart4 = echarts.init(chartDom4, 'dark');
var option4;

option4 = {
	title: {
    text: '广场动态数据'
  },
  legend: {},
  tooltip: {},
  dataset: {
    source: [
      ['product', 'Q1', 'Q2', 'Q3', 'Q4'],
      ['发布量', 0, 0, 0, 0],
      ['点赞量', 0, 0, 0, 0],
      ['评论量', 0, 0, 0, 0],
      ['收藏量', 0, 0, 0, 0],
      ['转发量', 0, 0, 0, 0]
    ]
  },
  xAxis: { type: 'category' },
  yAxis: {},
  // Declare several bar series, each will be mapped
  // to a column of dataset.source by default.
  series: [{ type: 'bar' }, { type: 'bar' }, { type: 'bar' }, { type: 'bar' }]
};

option4 && myChart4.setOption(option4);

var chartDom5 = document.getElementById('main_game');
var myChart5 = echarts.init(chartDom5, 'dark');
var option5;

option5 = {
	title: {
    text: '游戏活跃情况'
  },
  tooltip: {
    trigger: 'axis',
    axisPointer: {
      type: 'cross',
      crossStyle: {
        color: '#999'
      }
    }
  },
  toolbox: {
    feature: {
      dataView: { show: true, readOnly: false },
      magicType: { show: true, type: ['line', 'bar'] },
      restore: { show: false },
      saveAsImage: { show: true }
    }
  },
  legend: {
    data: ['发送邀请', '榜单查看', '签到', '人均游戏时长']
  },
  xAxis: [
    {
      type: 'category',
      data: ['Q1', 'Q2', 'Q3', 'Q4'],
      axisPointer: {
        type: 'shadow'
      }
    }
  ],
  yAxis: [
    {
      type: 'value',
      name: '人次/天',
      min: 0,
      max: 900,
      axisLabel: {
        formatter: '{value} '
      }
    },
    {
      type: 'value',
      name: '分钟/天',
      min: 0,
      max: 40,
      axisLabel: {
        formatter: '{value} '
      }
    }
  ],
  series: [
    {
      name: '发送邀请',
      type: 'bar',
      tooltip: {
        valueFormatter: function (value) {
          return value + ' 人次/天';
        }
      },
      data: [0,0,0,0]
    },
    {
      name: '榜单查看',
      type: 'bar',
      tooltip: {
        valueFormatter: function (value) {
          return value + ' 人次/天';
        }
      },
      data: [0,0,0,0]
    },
    {
      name: '签到',
      type: 'bar',
      tooltip: {
        valueFormatter: function (value) {
          return value + ' 人次/天';
        }
      },
      data: [0,0,0,0]
    },
    {
      name: '人均游戏时长',
      type: 'line',
      yAxisIndex: 1,
      tooltip: {
        valueFormatter: function (value) {
          return value + ' 分钟/天';
        }
      },
      data: [0,0,0,0]
    }
  ]
};

option5 && myChart5.setOption(option5);


var _panelImageURL = 'custom-gauge-panel.png';
var _animationDuration = 2000;
var _animationDurationUpdate = 2000;
var _animationEasingUpdate = 'quarticInOut';
var _valOnRadianMax = 10;
var _outerRadius = 90;
var _innerRadius = 70;
var _pointerInnerRadius = 10;
var _insidePanelRadius = 50;
var _currentDataIndex = 0;
function renderItem(params, api) {
  var valOnRadian = api.value(1);
  var coords = api.coord([api.value(0), valOnRadian]);
  var polarEndRadian = coords[3];
  var imageStyle = {
    image: _panelImageURL,
    x: params.coordSys.cx - _outerRadius,
    y: params.coordSys.cy - _outerRadius,
    width: _outerRadius * 2,
    height: _outerRadius * 2
  };
  return {
    type: 'group',
    children: [
      {
        type: 'image',
        style: imageStyle,
        clipPath: {
          type: 'sector',
          shape: {
            cx: params.coordSys.cx,
            cy: params.coordSys.cy,
            r: _outerRadius,
            r0: _innerRadius,
            startAngle: 0,
            endAngle: -polarEndRadian,
            transition: 'endAngle',
            enterFrom: { endAngle: 0 }
          }
        }
      },
      {
        type: 'image',
        style: imageStyle,
        clipPath: {
          type: 'polygon',
          shape: {
            points: makePionterPoints(params, polarEndRadian)
          },
          extra: {
            polarEndRadian: polarEndRadian,
            transition: 'polarEndRadian',
            enterFrom: { polarEndRadian: 0 }
          },
          during: function (apiDuring) {
            apiDuring.setShape(
              'points',
              makePionterPoints(params, apiDuring.getExtra('polarEndRadian'))
            );
          }
        }
      },
      {
        type: 'circle',
        shape: {
          cx: params.coordSys.cx,
          cy: params.coordSys.cy,
          r: _insidePanelRadius
        },
        style: {
          fill: '#fff',
          shadowBlur: 25,
          shadowOffsetX: 0,
          shadowOffsetY: 0,
          shadowColor: 'rgba(76,107,167,0.4)'
        }
      },
      {
        type: 'text',
        extra: {
          valOnRadian: valOnRadian,
          transition: 'valOnRadian',
          enterFrom: { valOnRadian: 0 }
        },
        style: {
          text: makeText(valOnRadian),
          fontSize: 30,
          fontWeight: 700,
          x: params.coordSys.cx,
          y: params.coordSys.cy,
          fill: 'rgb(0,50,190)',
          align: 'center',
          verticalAlign: 'middle',
          enterFrom: { opacity: 0 }
        },
        during: function (apiDuring) {
          apiDuring.setStyle(
            'text',
            makeText(apiDuring.getExtra('valOnRadian'))
          );
        }
      }
    ]
  };
}
function convertToPolarPoint(renderItemParams, radius, radian) {
  return [
    Math.cos(radian) * radius + renderItemParams.coordSys.cx,
    -Math.sin(radian) * radius + renderItemParams.coordSys.cy
  ];
}
function makePionterPoints(renderItemParams, polarEndRadian) {
  return [
    convertToPolarPoint(renderItemParams, _outerRadius, polarEndRadian),
    convertToPolarPoint(
      renderItemParams,
      _outerRadius,
      polarEndRadian + Math.PI * 0.03
    ),
    convertToPolarPoint(renderItemParams, _pointerInnerRadius, polarEndRadian)
  ];
}
function makeText(valOnRadian) {
  // Validate additive animation calc.
  if (valOnRadian < -10) {
    alert('illegal during val: ' + valOnRadian);
  }
  return ((valOnRadian / _valOnRadianMax) * 10).toFixed(0) ;
}
var chartDom6 = document.getElementById('main_party_UV');
var myChart6 = echarts.init(chartDom6, 'dark');
var option6;
option6 = {
	title: {
    text: '全年均值'
  },
  animationEasing: _animationEasingUpdate,
  animationDuration: _animationDuration,
  animationDurationUpdate: _animationDurationUpdate,
  animationEasingUpdate: _animationEasingUpdate,
  dataset: {
    source: [[0, 0]]
  },
  tooltip: {},
  angleAxis: {
    type: 'value',
    startAngle: 0,
    show: false,
    min: 0,
    max: _valOnRadianMax
  },
  radiusAxis: {
    type: 'value',
    show: false
  },
  polar: {},
  series: [
    {
      type: 'custom',
      coordinateSystem: 'polar',
      renderItem: renderItem
    }
  ]
};
option6 && myChart6.setOption(option6);



function csv2arr(csv_content){
	var arr = csv_content.split("\n");
	var results = [];
	for (var i=0;i<arr.length;i++){
		datalist = arr[i].split(",");
		results.push(datalist);
	}
	return results;
}
function get_last_record_value(csv_data_str, field_name, last_count=1){
	var arr_data = csv2arr(csv_data_str);
	var field_index = arr_data[0].indexOf(field_name);
	// var date_index = arr_data[0].indexOf(date_field_name);
	var value = Number(arr_data[arr_data.length - 1 - last_count][field_index]);
	return value;

}
function get_last_record_original_value(csv_data_str, field_name, last_count=1){
	var arr_data = csv2arr(csv_data_str);
	var field_index = arr_data[0].indexOf(field_name);
	// var date_index = arr_data[0].indexOf(date_field_name);
	var value = arr_data[arr_data.length - 1 - last_count][field_index];
	return value;
}
function cal_month_field_agg(csv_data_str, field_name_list, month="100000000000", date_field_name="Date"){
	var arr_data = csv2arr(csv_data_str);
	var field_index_list = [];
	for (var i=0; i<field_name_list.length;i++){
		field_index_list.push(arr_data[0].indexOf(field_name_list[i]))
	}
	
	var date_index = arr_data[0].indexOf(date_field_name);
	var months = [];
	for (var i=1;i<13;i++){
		if (month.charAt(i-1) == '1'){
			if (i <= 9){
				months.push('0' + String(i));
			}else{
				months.push(String(i));
			}
			
		}
	}
	// console.log(months);
	var row_count = 0;
	var amount_sum = [];
	for (var j=0;j<field_index_list.length;j++){
		amount_sum.push(0);
	}
	var resultObject = new Object();
	for (var i=1;i<arr_data.length;i++){
		if (months.indexOf(arr_data[i][date_index].split("-")[1]) > -1){
			row_count += 1;
			for (var j=0;j<field_index_list.length;j++){
				var temp_value = Number(arr_data[i][field_index_list[j]]);
				amount_sum[j] += temp_value;
			}
			
		}
	}
	var amount_avg = [];
	for (var j=0;j<field_index_list.length;j++){
		amount_avg.push(amount_sum[j] / row_count);
	}

	resultObject.row_count = row_count;
	resultObject.amount_sum = amount_sum;
	resultObject.amount_avg = amount_avg;
	return resultObject;
}
function cal_quarter_field_agg(csv_data_str, field_name, quarter="0001", date_field_name="Date"){
	var arr_data = csv2arr(csv_data_str);
	var field_index = arr_data[0].indexOf(field_name);
	var date_index = arr_data[0].indexOf(date_field_name);
	// 根据quarter属性生成可用月份列表
	var months = [];
	if (quarter.charAt(0) == '1'){
		months.push("01");
		months.push("02");
		months.push("03");
	}
	if (quarter.charAt(1) == '1'){
		months.push("04");
		months.push("05");
		months.push("06");
	}
	if (quarter.charAt(2) == '1'){
		months.push("07");
		months.push("08");
		months.push("09");
	}
	if (quarter.charAt(3) == '1'){
		months.push("10");
		months.push("11");
		months.push("12");
	}
	var row_count = 0;
	var amount_sum = 0;
	var resultObject = new Object();
	for (var i=1;i<arr_data.length;i++){
		if (months.indexOf(arr_data[i][date_index].split("-")[1]) > -1){
			row_count += 1;
			var temp_value = Number(arr_data[i][field_index]);
			amount_sum += temp_value;
		}
	}

	resultObject.row_count = row_count;
	resultObject.amount_sum = amount_sum;
	resultObject.amount_avg = amount_sum / row_count;
	return resultObject;

		

}
var fileInput = document.getElementById("csv");
var csv_file_content;
var dd;
readFile = function () {
    var reader = new FileReader();
    reader.onload = function () {
        
        csv_file_content = reader.result;
        var test_dd = cal_quarter_field_agg(csv_file_content, "avg_rounds", quarter="1111");
        // document.getElementById("out").innerHTML = test_dd;
        // console.log(test_dd);

        // 私聊小功能数据 刷新
        var mon_data = [];
        var mon_str = '1';

        for (var i = 1; i <= 12; i++) {
        	switch(i){
        		case 1: mon_str = '100000000000';break;
        		case 2: mon_str = '010000000000';break;
        		case 3: mon_str = '001000000000';break;
        		case 4: mon_str = '000100000000';break;
        		case 5: mon_str = '000010000000';break;
        		case 6: mon_str = '000001000000';break;
        		case 7: mon_str = '000000100000';break;
        		case 8: mon_str = '000000010000';break;
        		case 9: mon_str = '000000001000';break;
        		case 10: mon_str = '000000000100';break;
        		case 11: mon_str = '000000000010';break;
        		case 12: mon_str = '000000000001';break;
        	} 
        	var tmp = cal_month_field_agg(csv_file_content, ['sticker_rate','templates_rate','magic_voice_rate','fake_face_rate'],
        	month=mon_str, date_field_name="Date");
        	mon_data.push(tmp);
        }
      	// console.log(mon_data);
        myChart2.setOption({
		  legend: {
		    type: 'scroll',
		    bottom: 10,
		    data: (function () {
		      var list = [];
		      for (var i = 1; i <= 12; i++) {
		        list.push(i + '月');
		      }
		      return list;
		    })()
		  },
		  series: (function () {
		    var series = [];
		    for (var i = 0; i < 12; i++) {
		      series.push({
		        type: 'radar',
		        data: [
		          {
		            value: [
		              mon_data[i].amount_avg[0].toFixed(2),
		              mon_data[i].amount_avg[1].toFixed(2),
		              mon_data[i].amount_avg[2].toFixed(2),
		              mon_data[i].amount_avg[3].toFixed(2)
		            ],
		            name: i + 1 + '月'
		          }
		        ]
		      });
		    }
		    return series;
		  })()
		});
        // 个人主页漏斗数据刷新
        var pp_views = cal_quarter_field_agg(csv_file_content, "pp_views", quarter="1111");
        var pp_likes = cal_quarter_field_agg(csv_file_content, "pp_likes", quarter="1111");
        var pp_forwards = cal_quarter_field_agg(csv_file_content, "pp_forwards", quarter="1111");
        myChart1.setOption({
		    series: [
			    {
			      data: [
			        { value: pp_views.amount_avg.toFixed(2), name: '曝光浏览' },
			        { value: pp_likes.amount_avg.toFixed(2), name: '点赞' },
			        { value: pp_forwards.amount_avg.toFixed(2), name: '转发' }
			      ]
			    }
			  ]
		});

		// 日均其他数据
		var d_avg_room_uv = cal_quarter_field_agg(csv_file_content, "room_uv", quarter="1111");
		var d_avg_avg_rounds = cal_quarter_field_agg(csv_file_content, "avg_rounds", quarter="1111");
		var d_avg_avg_voice = cal_quarter_field_agg(csv_file_content, "avg_voice", quarter="1111");
		var d_avg_avg_video = cal_quarter_field_agg(csv_file_content, "avg_video", quarter="1111");
		var d_avg_rcomments = cal_quarter_field_agg(csv_file_content, "random_comments", quarter="1111");
		var d_avg_hcomments = cal_quarter_field_agg(csv_file_content, "host_comments", quarter="1111");
		var host_reply_rate = d_avg_hcomments.amount_sum / d_avg_rcomments.amount_sum * 100;

		setInterval(function () {
			var data_list = [Math.round(d_avg_room_uv.amount_avg), d_avg_avg_rounds.amount_avg.toFixed(2), 
			d_avg_avg_video.amount_avg.toFixed(2), d_avg_avg_voice.amount_avg.toFixed(2), host_reply_rate];
			var idx = Math.floor(Math.random()*data_list.length);
			var name_list = ['派对房间UV (人次/天)','人均游戏局数 ','人均视频时长 (min/天)',
			'人均语音通话时长 (min/天)', '楼主回复率 %'];
		  var nextSource = [[1, data_list[idx]]];
		  myChart6.setOption({
		    dataset: {
		      source: nextSource
		    }
		  });
		  document.getElementById("nihao").innerHTML = name_list[idx];
		}, 2000);

		// 派对数据 刷新
		var q1_room_uv = Math.round(cal_quarter_field_agg(csv_file_content, "room_num", quarter="1000").amount_avg);
		var q2_room_uv = Math.round(cal_quarter_field_agg(csv_file_content, "room_num", quarter="0100").amount_avg);
		var q3_room_uv = Math.round(cal_quarter_field_agg(csv_file_content, "room_num", quarter="0010").amount_avg);
		var q4_room_uv = Math.round(cal_quarter_field_agg(csv_file_content, "room_num", quarter="0001").amount_avg);

		var q1_room_time = cal_quarter_field_agg(csv_file_content, "room_time", quarter="1000").amount_avg.toFixed(1);
		var q2_room_time = cal_quarter_field_agg(csv_file_content, "room_time", quarter="0100").amount_avg.toFixed(1);
		var q3_room_time = cal_quarter_field_agg(csv_file_content, "room_time", quarter="0010").amount_avg.toFixed(1);
		var q4_room_time = cal_quarter_field_agg(csv_file_content, "room_time", quarter="0001").amount_avg.toFixed(1);

		var q1_mike_rate = cal_quarter_field_agg(csv_file_content, "mike_rate", quarter="1000").amount_avg.toFixed(1);
		var q2_mike_rate = cal_quarter_field_agg(csv_file_content, "mike_rate", quarter="0100").amount_avg.toFixed(1);
		var q3_mike_rate = cal_quarter_field_agg(csv_file_content, "mike_rate", quarter="0010").amount_avg.toFixed(1);
		var q4_mike_rate = cal_quarter_field_agg(csv_file_content, "mike_rate", quarter="0001").amount_avg.toFixed(1);
		myChart3.setOption({
		    series: [
			    {
			      name: '日均房间数',
			      type: 'bar',
			      data: [q1_room_uv, q2_room_uv, q3_room_uv, q4_room_uv],
			      markPoint: {
			        data: [
			          { type: 'max', name: 'Max' },
			          { type: 'min', name: 'Min' }
			        ]
			      },
			      markLine: {
			        data: [{ type: 'average', name: 'Avg' }]
			      }
			    },
			    {
			      name: '房均时长 min',
			      type: 'bar',
			      data: [q1_room_time, q2_room_time, q3_room_time, q4_room_time],
			      markPoint: {
			        data: [
			          { type: 'max', name: 'Max' },
			          { type: 'min', name: 'Min' }
			        ]
			      },
			      markLine: {
			        data: [{ type: 'average', name: 'Avg' }]
			      }
			    },
			    {
			      name: '上麦率',
			      type: 'line',
			      data: [q1_mike_rate, q2_mike_rate, q3_mike_rate, q4_mike_rate]
			    }
			  ]
		});

		// 游戏活跃情况 刷新

		var q1_invite = Math.round(cal_quarter_field_agg(csv_file_content, "game_invitation", quarter="1000").amount_avg);
		var q2_invite = Math.round(cal_quarter_field_agg(csv_file_content, "game_invitation", quarter="0100").amount_avg);
		var q3_invite = Math.round(cal_quarter_field_agg(csv_file_content, "game_invitation", quarter="0010").amount_avg);
		var q4_invite = Math.round(cal_quarter_field_agg(csv_file_content, "game_invitation", quarter="0001").amount_avg);

		var q1_board = Math.round(cal_quarter_field_agg(csv_file_content, "game_board_view", quarter="1000").amount_avg);
		var q2_board = Math.round(cal_quarter_field_agg(csv_file_content, "game_board_view", quarter="0100").amount_avg);
		var q3_board = Math.round(cal_quarter_field_agg(csv_file_content, "game_board_view", quarter="0010").amount_avg);
		var q4_board = Math.round(cal_quarter_field_agg(csv_file_content, "game_board_view", quarter="0001").amount_avg);

		var q1_attendance = Math.round(cal_quarter_field_agg(csv_file_content, "game_attendance", quarter="1000").amount_avg);
		var q2_attendance = Math.round(cal_quarter_field_agg(csv_file_content, "game_attendance", quarter="0100").amount_avg);
		var q3_attendance = Math.round(cal_quarter_field_agg(csv_file_content, "game_attendance", quarter="0010").amount_avg);
		var q4_attendance = Math.round(cal_quarter_field_agg(csv_file_content, "game_attendance", quarter="0001").amount_avg);

		var q1_avg_gametime = cal_quarter_field_agg(csv_file_content, "avg_gametime", quarter="1000").amount_avg.toFixed(1);
		var q2_avg_gametime = cal_quarter_field_agg(csv_file_content, "avg_gametime", quarter="0100").amount_avg.toFixed(1);
		var q3_avg_gametime = cal_quarter_field_agg(csv_file_content, "avg_gametime", quarter="0010").amount_avg.toFixed(1);
		var q4_avg_gametime = cal_quarter_field_agg(csv_file_content, "avg_gametime", quarter="0001").amount_avg.toFixed(1);



		myChart5.setOption({
		    series: [
			    {
			      name: '发送邀请',
			      type: 'bar',
			      tooltip: {
			        valueFormatter: function (value) {
			          return value + ' 人次/天';
			        }
			      },
			      data: [q1_invite, q2_invite, q3_invite, q4_invite]
			    },
			    {
			      name: '榜单查看',
			      type: 'bar',
			      tooltip: {
			        valueFormatter: function (value) {
			          return value + ' 人次/天';
			        }
			      },
			      data: [q1_board, q2_board, q3_board, q4_board]
			    },
			    {
			      name: '签到',
			      type: 'bar',
			      tooltip: {
			        valueFormatter: function (value) {
			          return value + ' 人次/天';
			        }
			      },
			      data: [q1_attendance, q2_attendance, q3_attendance, q4_attendance]
			    },
			    {
			      name: '人均游戏时长',
			      type: 'line',
			      yAxisIndex: 1,
			      tooltip: {
			        valueFormatter: function (value) {
			          return value + ' 分钟/天';
			        }
			      },
			      data: [q1_avg_gametime, q2_avg_gametime, q3_avg_gametime, q4_avg_gametime]
			    }
			  ]
		});

		// 本年度平均DAU 刷新
		var avg_dau = cal_quarter_field_agg(csv_file_content, "dau", quarter="1111");
		myChart0.setOption({
		    series: [
			    {
			      data: [
			        {
			          value: Number(avg_dau.amount_avg / 70000),
			          name: '平均DAU ' + String(Math.round(avg_dau.amount_avg))
			        }
			      ]
			    }
			  ]
		});

		// 广场数据 刷新
		var q1_posts = Math.round(cal_quarter_field_agg(csv_file_content, "posts", quarter="1000").amount_avg);
		var q2_posts = Math.round(cal_quarter_field_agg(csv_file_content, "posts", quarter="0100").amount_avg);
		var q3_posts = Math.round(cal_quarter_field_agg(csv_file_content, "posts", quarter="0010").amount_avg);
		var q4_posts = Math.round(cal_quarter_field_agg(csv_file_content, "posts", quarter="0001").amount_avg);

		var q1_likes = Math.round(cal_quarter_field_agg(csv_file_content, "likes", quarter="1000").amount_avg);
		var q2_likes = Math.round(cal_quarter_field_agg(csv_file_content, "likes", quarter="0100").amount_avg);
		var q3_likes = Math.round(cal_quarter_field_agg(csv_file_content, "likes", quarter="0010").amount_avg);
		var q4_likes = Math.round(cal_quarter_field_agg(csv_file_content, "likes", quarter="0001").amount_avg);

		var q1_random_comments = Math.round(cal_quarter_field_agg(csv_file_content, "random_comments", quarter="1000").amount_avg);
		var q2_random_comments = Math.round(cal_quarter_field_agg(csv_file_content, "random_comments", quarter="0100").amount_avg);
		var q3_random_comments = Math.round(cal_quarter_field_agg(csv_file_content, "random_comments", quarter="0010").amount_avg);
		var q4_random_comments = Math.round(cal_quarter_field_agg(csv_file_content, "random_comments", quarter="0001").amount_avg);

		var q1_collects = Math.round(cal_quarter_field_agg(csv_file_content, "collects", quarter="1000").amount_avg);
		var q2_collects = Math.round(cal_quarter_field_agg(csv_file_content, "collects", quarter="0100").amount_avg);
		var q3_collects = Math.round(cal_quarter_field_agg(csv_file_content, "collects", quarter="0010").amount_avg);
		var q4_collects = Math.round(cal_quarter_field_agg(csv_file_content, "collects", quarter="0001").amount_avg);

		var q1_forwards = Math.round(cal_quarter_field_agg(csv_file_content, "forwards", quarter="1000").amount_avg);
		var q2_forwards = Math.round(cal_quarter_field_agg(csv_file_content, "forwards", quarter="0100").amount_avg);
		var q3_forwards = Math.round(cal_quarter_field_agg(csv_file_content, "forwards", quarter="0010").amount_avg);
		var q4_forwards = Math.round(cal_quarter_field_agg(csv_file_content, "forwards", quarter="0001").amount_avg);

		myChart4.setOption({
		    dataset: {
		      source: [
		      ['product', 'Q1', 'Q2', 'Q3', 'Q4'],
		      ['发布量', q1_posts, q2_posts, q3_posts, q4_posts],
		      ['点赞量', q1_likes, q2_likes, q3_likes, q4_likes],
		      ['评论量', q1_random_comments, q2_random_comments, q3_random_comments, q4_random_comments],
		      ['收藏量', q1_collects, q2_collects, q3_collects, q4_collects],
		      ['转发量', q1_forwards, q2_forwards, q3_forwards, q4_forwards]
		    ]}
		  });


		// 细分日活及 日消费GMV
		var sum_game_dau = cal_quarter_field_agg(csv_file_content, "game_dau", quarter="1111")
		var sum_square_dau = cal_quarter_field_agg(csv_file_content, "square_dau", quarter="1111")
		var sum_pchat_dau = cal_quarter_field_agg(csv_file_content, "pchat_dau", quarter="1111")
		var sum_party_dau = cal_quarter_field_agg(csv_file_content, "party_dau", quarter="1111")
		var sum_referal_dau = cal_quarter_field_agg(csv_file_content, "referal_dau", quarter="1111")
		var sum_consume_dau = cal_quarter_field_agg(csv_file_content, "consume_dau", quarter="1111")
		var sum_dgmv = cal_quarter_field_agg(csv_file_content, "dgmv", quarter="1111")


		document.getElementById("td_square_dau").innerHTML = "广场<br/>" + sum_square_dau.amount_sum;
		document.getElementById("td_pchat_dau").innerHTML = "私聊<br/>" + sum_pchat_dau.amount_sum;
		document.getElementById("td_party_dau").innerHTML = "派对<br/>" + sum_party_dau.amount_sum;
		document.getElementById("td_referal_dau").innerHTML = "推荐<br/>" + sum_referal_dau.amount_sum;
		document.getElementById("td_consume_dau").innerHTML = "消费<br/>" + sum_consume_dau.amount_sum;
		document.getElementById("td_game_dau").innerHTML = "游戏<br/>" + sum_game_dau.amount_sum;
		document.getElementById("td_dgmv").innerHTML = "总消费GMV<br/>" + sum_dgmv.amount_sum;
		

		// 填充最后一条记录的日期
		var curr_date = get_last_record_original_value(csv_file_content, 'Date', last_count=1);
		document.getElementById("curr_date").innerHTML = curr_date.substr(0,10);



    };
    // start reading the file. When it is done, calls the onload event defined above.
    // reader.readAsBinaryString(fileInput.files[0]);
    reader.readAsText(fileInput.files[0]);
};

fileInput.addEventListener('change', readFile);

window.onload = function () { //里面放需要加载的js


  };


</script>


  </body>
</html>